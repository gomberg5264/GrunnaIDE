"use strict";let ws=null;$((function(){startWs();var shellprompt="$ ";window.addEventListener("resize",(function(){document.getElementById("terminal-continer").style.height="100%";globalValues.xtermFitAddon.fit()}));$("#terminal-tab").on("shown.bs.tab",(function(){if(!globalValues.xterm){let termContainer=document.getElementById("terminal-continer");globalValues.xterm=new Terminal({cursorBlink:true});globalValues.xterm.open(termContainer);globalValues.xtermFitAddon=new FitAddon;globalValues.xterm.loadAddon(globalValues.xtermFitAddon);globalValues.xterm.write("~$ ");var input="";globalValues.xterm.onData((function(data){const code=data.charCodeAt(0);ws.getSubscription("docker:terminal").emit("dockerInput",{character:data})}));document.getElementById("terminal-continer").style.height="100%";globalValues.xtermFitAddon.fit()}}))}));function startWs(){console.log("Start Ws");ws=adonis.Ws().connect();ws.on("open",()=>{subscribeToOutputChannel();subscribeToTerminalChannel()})}function subscribeToOutputChannel(){const infoChannel=ws.subscribe("docker:infoChannel");console.log("infoChannel; ",infoChannel);infoChannel.on("output",output=>{let addNewData=output+"<br/>";$("#outputData").append(addNewData)})}function subscribeToTerminalChannel(){const terminalChannel=ws.subscribe("docker:terminal");console.log("terminalChannel: ",terminalChannel);terminalChannel.on("terminal",terminal=>{if(globalValues.xterm){globalValues.xterm.write(terminal)}$("#terminalOutput").append(terminal);$("#terminalOutput").scrollTop($("#terminalOutput").prop("scrollHeight"))})}"use strict";$((function(){CodeMirror.modeURL="/codemirror/mode/%N/%N.js";globalValues.codemirrorInstance=CodeMirror.fromTextArea(document.getElementById("allMyCode"),{lineNumbers:true,tabSize:2,extraKeys:{"Ctrl-Space":"autocomplete"},autoCloseBrackets:true,matchBrackets:true,autoCloseTags:true,foldGutter:true,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],showTrailingSpace:true});$(document).keydown((function(event){if(event.ctrlKey&&event.keyCode==83){event.preventDefault();$.ajax({type:"POST",url:"/api/file/saveFile",data:{fileName:globalValues.loadedFilePath,data:globalValues.codemirrorInstance.getValue()},success:data=>{console.log("returnCreate: ",data)}});$('<div class="alert alert-success">'+'<button type="button" class="close" data-dismiss="alert">'+"&times;</button>File have been saved</div>").hide().appendTo("#alerts").fadeIn(1e3);$(".alert").delay(3e3).fadeOut("normal",(function(){$(this).alert("close")}))}}))}));"use strict";$((function(){$("#reloadFileTree").on("click",(function(e){console.log("working");$.ajax({type:"GET",url:"/api/file/reloadFileTree",success:function(data){$("#filetree").fancytree("getTree").reload(createTree(data))}})}))}));"use strict";var globalValues={loadedProject:"",loadedFile:"",loadedFilePath:"",action:"",postData:{},username:"",codemirrorInstance:null,xterm:null,xtermFitAddon:null};"use strict";$((function(){$("#run").on("click",(function(e){$.ajax({type:"POST",url:"/api/docker/compile",success:function(data){console.log("Ajax Post return data: ",data)}})}));$("#menuGitFetch").on("click",(function(e){$.ajax({type:"POST",url:"/api/git/fetch",data:globalValues.postData,success:function(data){console.log("Fetch return: ",data)},error:function(xhr,ajaxOptions,thrownError){console.log("ERROR",xhr);if(xhr.status===401){globalValues.action="gitFetch";globalValues.postData={};if(globalValues.username){$("#gitUsernameModalInput").val(globalValues.username)}$("#gitUsernameModal").modal("show")}}})}));$("#menuGitStatus").on("click",(function(e){$.ajax({type:"POST",url:"/api/git/status",success:function(data){data.stage.forEach(element=>{if(element.status!=="unmodified"){$("#outputData").append("File: "+element.file+" "+element.status+"\n")}});$("#outputData").append("-----------------------------------\n")}})}));$("#menuGitAdd").on("click",(function(e){$("#gitAddModal").modal("show")}));$("#gitAddModalInput").keypress((function(event){var keycode=event.keyCode?event.keyCode:event.which;if(keycode=="13"){$("#gitAddModal").modal("hide");let message=$("#gitAddModalInput").val();$.ajax({type:"POST",url:"/api/git/add",data:{file:message},success:function(data){console.log("Fetch return: ",data)}})}}));$("#menuGitCommit").on("click",(function(e){$("#gitCommitMessageModal").modal("show")}));$("#gitCommitMessageModalInput").keypress((function(event){var keycode=event.keyCode?event.keyCode:event.which;if(keycode=="13"){$("#gitCommitMessageModal").modal("hide");let message=$("#gitCommitMessageModalInput").val();$.ajax({type:"POST",url:"/api/git/commit",data:{commitMessage:message},success:function(data){console.log("Fetch return: ",data)}})}}));$("#menuGitPush").on("click",(function(e){$.ajax({type:"POST",url:"/api/git/push",data:globalValues.postData,success:function(data){$("#filetree").fancytree("getTree").reload(createTree(data))},error:function(xhr,ajaxOptions,thrownError){console.log("ERROR",xhr);if(xhr.status===401){globalValues.action="gitPush";globalValues.postData={};if(globalValues.username){$("#gitUsernameModalInput").val(globalValues.username)}$("#gitUsernameModal").modal("show")}}})}));$("#menuGitPull").on("click",(function(e){$.ajax({type:"POST",url:"/api/git/pull",data:globalValues.postData,success:function(data){$("#filetree").fancytree("getTree").reload(createTree(data))},error:function(xhr,ajaxOptions,thrownError){if(xhr.status===401){globalValues.action="gitPull";globalValues.postData={};if(globalValues.username){$("#gitUsernameModalInput").val(globalValues.username)}$("#gitUsernameModal").modal("show")}}})}));$("#menuGitTest").on("click",(function(e){$.ajax({type:"POST",url:"/api/git/test",success:function(data){console.log("Fetch return: ",data)}})}));function commitChanges(message){}}));"use strict";$((function(){$("#filetree").fancytree({extensions:["childcounter"],activate:(event,data)=>{if(!data.node.isFolder()){retriveFile(data.node.key)}},source:[],childcounter:{deep:true,hideZeros:true,hideExpanded:true}});$("#create-project-form").on("submit",(function(e){if(!e.isDefaultPrevented()){let formData=$(this).serialize();console.log("formData",formData);$.ajax({type:"POST",url:"/api/project/createProject",data:formData}).done(data=>{$("#createProjectDialog").modal("hide");$("#filetree").fancytree("getTree").reload(createTree(data));createNewDocker()}).fail((data,textStatus,thrown)=>{console.log("dataError",data);if(data.status===401){$("#createProjectDialog").modal("hide");globalValues.action="createNewProject";if(globalValues.username){$("#gitUsernameModalInput").val(globalValues.username)}$("#gitUsernameModal").modal("show")}});return false}e.preventDefault()}));$("#gitUsernameModalInput").keypress((function(event){var keycode=event.keyCode?event.keyCode:event.which;if(keycode=="13"){$("#gitUsernameModal").modal("hide");globalValues.username=$("#gitUsernameModalInput").val();$("#createProjectUsername").val($("#gitUsernameModalInput").val());globalValues.postData.username=$("#gitUsernameModalInput").val();$("#gitPasswordModal").modal("show")}}));$("#gitPasswordModalInput").keypress((function(event){var keycode=event.keyCode?event.keyCode:event.which;if(keycode=="13"){$("#gitPasswordModal").modal("hide");$("#createProjectPassword").val($("#gitPasswordModalInput").val());globalValues.postData.password=$("#gitPasswordModalInput").val();$("#gitPasswordModalInput").val("");switch(globalValues.action){case"createNewProject":$("#create-project-form").submit();break;case"gitPull":$("#menuGitPull").click();break;case"gitPush":$("#menuGitPush").click();break;case"gitFetch":$("#menuGitFetch").click();break}globalValues.action=""}}));$("#openProjectDialog").on("show.bs.modal",(function(event){$.ajax({type:"GET",url:"/api/project/featchAllProjects",success:function(data){$("#openProjectControlSelect").empty();data.forEach(project=>{$("#openProjectControlSelect").append('<option value="'+project.id+'">'+project.name+"</option>")})}})}));$("#createProjectDialog").on("show.bs.modal",(function(event){$.ajax({type:"GET",url:"/api/project/listAllAvailibleImages",success:function(data){$("#createProjectImageSelect").empty();data.forEach(project=>{$("#createProjectImageSelect").append('<option value="'+project+'">'+project+"</option>")})}})}));$("#projectSettingsDialog").on("show.bs.modal",(function(event){$.ajax({type:"GET",url:"/api/project/listAllAvailibleImages",success:function(data){$("#projectSettingsImageSelect").empty();data.forEach(project=>{$("#projectSettingsImageSelect").append('<option value="'+project+'">'+project+"</option>")})}})}));$("#open-project-form").on("submit",(function(event){let projectIdNumber=$("#openProjectControlSelect").children("option:selected").val();$.ajax({type:"GET",url:"/api/project/getAllFiles",data:{projectId:projectIdNumber},success:function(data){$("#openProjectDialog").modal("hide");$("#filetree").fancytree("getTree").reload(createTree(data));createNewDocker()}});event.preventDefault()}));$("#menuRemoveProject").on("click",(function(event){$.ajax({type:"POST",url:"/api/project/removeProject",success:function(data){console.log("Remove project: ",data)}})}));$("#project-settings-form").on("submit",(function(e){if(!e.isDefaultPrevented()){let formData=$(this).serialize();console.log("formData",formData);$.ajax({type:"POST",url:"/api/project/projectSettings",data:formData}).done(data=>{$("#projectSettingsDialog").modal("hide");createNewDocker()}).fail((data,textStatus,thrown)=>{console.log("dataError",data)});return false}e.preventDefault()}))}));function createNewDocker(){$.ajax({type:"POST",url:"/api/docker/createDocker",data:{},success:function(data){console.log("created docker: ",data);ws.getSubscription("docker:terminal").emit("dockerAttach",{})}})}function retriveFile(path){console.log("path: ",path);$.ajax({type:"POST",url:"/api/file/downloadFile",data:{fileName:path},success:data=>{var val=path,m,mode,spec;if(m=/.+\.([^.]+)$/.exec(val)){var info=CodeMirror.findModeByExtension(m[1]);if(info){mode=info.mode;spec=info.mime}}else if(/\//.test(val)){var info=CodeMirror.findModeByMIME(val);if(info){mode=info.mode;spec=val}}else{mode=spec=val}if(mode){globalValues.codemirrorInstance.setOption("mode",spec);CodeMirror.autoLoadMode(globalValues.codemirrorInstance,mode)}globalValues.codemirrorInstance.setValue(data);globalValues.loadedFile=data;globalValues.loadedFilePath=path}})}function updateTree(data){$("#filetree").fancytree({extensions:["childcounter"],activate:(event,data)=>{if(!data.node.isFolder()){retriveFile(data.node.key)}},source:createTree(data),childcounter:{deep:true,hideZeros:true,hideExpanded:true}})}function createTree(array){let outputArray=[];if(Array.isArray(array)){array.forEach(a=>{if(a.children){outputArray.push({title:a.name,key:a.path,folder:true,children:createTree(a.children)})}else{outputArray.push({title:a.name,key:a.path})}})}else{if(array.children){outputArray.push({title:array.name,key:array.path,folder:true,children:createTree(array.children)})}else{outputArray.push({title:array.name,key:array.path})}}return outputArray}"use strict";(function(){WsNotice();fileMenu()})();function WsNotice(){let ws=adonis.Ws().connect();let error=false;ws.on("open",()=>{$('<div class="alert alert-success">'+'<button type="button" class="close" data-dismiss="alert">'+"&times;</button>Connected to Ws</div>").hide().appendTo("#alerts").fadeIn(1e3);$(".alert").delay(3e3).fadeOut("normal",(function(){$(this).alert("close")}));error=false});ws.on("error",event=>{if(!error){$('<div class="alert alert-error">'+'<button type="button" class="close" data-dismiss="alert">'+"&times;</button>Error with connection to WS</div>").hide().appendTo("#alerts").fadeIn(1e3);$(".alert").delay(3e3).fadeOut("normal",(function(){$(this).alert("close")}));error=true}})}function fileMenu(){$.contextMenu({selector:"#filetree span.fancytree-title",items:{createDirectory:{name:"Create Directory",icon:"copy",callback:function(key,opt){var node=$.ui.fancytree.getNode(opt.$trigger);globalValues.postData={};globalValues.postData.fromDirectory=node.key;$("#createDirectoryModalInput").val("");$("#createDirectoryModal").modal("show")}},createFile:{name:"Create file",icon:"copy",callback:function(key,opt){var node=$.ui.fancytree.getNode(opt.$trigger);globalValues.postData={};globalValues.postData.fromDirectory=node.key;$("#createFileModal").modal("show")}},delete:{name:"Delete",icon:"trash",callback:function(key,opt){var node=$.ui.fancytree.getNode(opt.$trigger);globalValues.postData={};globalValues.postData.fileOrDirectory=node.key;let deleteModal=$("#deleteFileDirectoryModal");deleteModal.find(".modal-body").text("Delete: "+node.key);deleteModal.modal("show")}}},callback:function(itemKey,opt){var node=$.ui.fancytree.getNode(opt.$trigger);alert("select "+itemKey+" on "+node)}});$("#createDirectoryModalInput").keypress((function(event){var keycode=event.keyCode?event.keyCode:event.which;if(keycode=="13"){$("#createDirectoryModal").modal("hide");globalValues.postData.newDirectory=$("#createDirectoryModalInput").val();$.ajax({type:"POST",url:"/api/file/createDirectory",data:globalValues.postData,success:data=>{$("#filetree").fancytree("getTree").reload(createTree(data))}})}}));$("#createFileModalInput").keypress((function(event){var keycode=event.keyCode?event.keyCode:event.which;if(keycode=="13"){$("#createFileModal").modal("hide");globalValues.postData.newFile=$("#createFileModalInput").val();$.ajax({type:"POST",url:"/api/file/createFile",data:globalValues.postData,success:data=>{$("#filetree").fancytree("getTree").reload(createTree(data))}})}}));$("#deleteFileDirectoryModalBtn").on("click",(function(e){console.log("delete file: ",globalValues.postData);$("#deleteFileDirectoryModal").modal("hide");$.ajax({type:"DELETE",url:"/api/file/deleteFileDirectory",data:globalValues.postData,success:data=>{$("#filetree").fancytree("getTree").reload(createTree(data))}})}))}